# Task 001: Project Setup and Infrastructure

## Описание
Настройка базовой инфраструктуры проекта, включая FastAPI, PostgreSQL, Redis и структуру проекта

## Приоритет: HIGH
## Сложность: MEDIUM
## Оценка времени: 8 часов
## Зависимости: Нет

## Детальный план выполнения

### Подзадача 1.1: Создание FastAPI проекта (2 часа)
**Файлы для создания:**
- `app/main.py` - точка входа приложения
- `requirements.txt` - зависимости Python
- `app/__init__.py` - инициализация пакета
- `app/api/__init__.py` - API модуль

**Детали реализации:**
Создать основную структуру FastAPI с роутерами, middleware, CORS настройками

### Подзадача 1.2: Настройка виртуального окружения (1 час)
**Файлы для создания:**
- `requirements.txt` - основные зависимости
- `.env.example` - пример переменных окружения
- `pyproject.toml` - конфигурация проекта

**Детали реализации:**
Poetry или pip-tools для управления зависимостями

### Подзадача 1.3: Docker конфигурация (2 часа)
**Файлы для создания:**
- `Dockerfile` - образ приложения
- `docker-compose.yml` - сервисы для разработки
- `.dockerignore` - исключения для Docker

**Детали реализации:**
Multi-stage build, оптимизация размера образа

### Подзадача 1.4: Git репозиторий и CI/CD (2 часа)
**Файлы для создания:**
- `.gitignore` - исключения Git
- `.github/workflows/ci.yml` - GitHub Actions
- `README.md` - документация проекта

**Детали реализации:**
GitHub Actions для тестирования и линтинга

### Подзадача 1.5: Базовые тесты инфраструктуры (1 час)
**Файлы для создания:**
- `tests/__init__.py`
- `tests/test_main.py` - тесты основного приложения
- `pytest.ini` - конфигурация pytest

**Детали реализации:**
Pytest конфигурация и базовые health check тесты

### Подзадача 1.6: Структурированное логирование (1 час)
**Файлы для создания:**
- `app/core/logging.py` - конфигурация логирования
- `app/utils/logger.py` - утилиты для логирования
- `logs/.gitkeep` - папка для логов

**Детали реализации:**
- Настройка structlog для структурированного логирования
- Correlation ID для трассировки запросов
- Различные уровни логирования для разных окружений
- Ротация логов и форматирование JSON

### Подзадача 1.7: Детальные интеграционные тесты (2 часа)
**Файлы для создания:**
- `tests/integration/test_api_endpoints.py` - тесты API
- `tests/integration/test_health_checks.py` - тесты health check
- `tests/unit/test_config.py` - тесты конфигурации
- `tests/conftest.py` - фикстуры для тестов

**Детали реализации:**
- Тесты всех endpoint'ов с различными сценариями
- Тесты конфигурации и переменных окружения
- Тесты CORS и middleware
- Тесты обработки ошибок
- Мокирование внешних зависимостей

### Подзадача 1.8: Мониторинг и метрики (1 час)
**Файлы для создания:**
- `app/core/metrics.py` - Prometheus метрики
- `app/middleware/monitoring.py` - middleware для мониторинга
- `scripts/health_check.py` - скрипт для проверки здоровья

**Детали реализации:**
- Базовые метрики: время ответа, количество запросов, ошибки
- Health check с проверкой зависимостей
- Middleware для сбора метрик по endpoint'ам

## Критерии готовности
- [ ] FastAPI приложение запускается без ошибок
- [ ] Docker контейнеры собираются и запускаются
- [ ] Все тесты проходят (unit + integration)
- [ ] Health check endpoint отвечает
- [ ] Логирование работает корректно
- [ ] Метрики собираются
- [ ] CI/CD pipeline выполняется успешно
- [ ] Покрытие тестами >80%

## Детальные тесты

### Unit тесты:
- Тест создания FastAPI приложения
- Тест конфигурации settings
- Тест middleware настроек
- Тест роутеров и их подключения

### Integration тесты:
- Тест всех endpoint'ов (/health, /, /api/v1/health/)
- Тест CORS headers
- Тест обработки ошибок
- Тест документации API (swagger/redoc)

### Performance тесты:
- Тест времени запуска приложения
- Тест времени ответа endpoint'ов
- Тест нагрузки на health check

## Логирование

### Структура логов:
```json
{
  "timestamp": "2025-07-11T04:50:00Z",
  "level": "INFO",
  "service": "whatsapp-hotel-bot",
  "version": "1.0.0",
  "correlation_id": "req-123456",
  "endpoint": "/health",
  "method": "GET",
  "status_code": 200,
  "response_time_ms": 15,
  "user_agent": "curl/7.68.0"
}
```

### Уровни логирования:
- **DEBUG**: Детальная информация для отладки
- **INFO**: Общая информация о работе приложения
- **WARNING**: Предупреждения о потенциальных проблемах
- **ERROR**: Ошибки, требующие внимания
- **CRITICAL**: Критические ошибки, влияющие на работу

## Связанные задачи
- **Следующая задача:** Task 002 (Database Schema Design)
- **Блокирует:** Tasks 003, 004, 010, 013

## Заметки
- Использовать async/await для всех операций
- Настроить структурированное логирование с самого начала
- Подготовить конфигурацию для разных окружений (dev/staging/prod)
- Все тесты должны быть независимыми и воспроизводимыми
- Логи должны содержать достаточно информации для отладки
