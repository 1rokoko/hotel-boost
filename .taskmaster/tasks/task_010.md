# Task 010: Celery Task Queue Setup

## Описание
Настройка Celery для асинхронной обработки задач

## Приоритет: MEDIUM
## Сложность: MEDIUM
## Оценка времени: 10 часов
## Зависимости: Task 001, Task 002

## Детальный план выполнения

### Подзадача 10.1: Конфигурация Celery (2 часа)
**Файлы для создания:**
- `app/core/celery.py` - основная конфигурация Celery
- `app/core/celery_config.py` - настройки брокера и результатов
- `celery_worker.py` - точка входа для воркеров

**Детали реализации:**
```python
# app/core/celery.py
from celery import Celery

celery_app = Celery("hotel_bot")
celery_app.config_from_object("app.core.celery_config")
celery_app.autodiscover_tasks(["app.tasks"])
```

### Подзадача 10.2: Базовые задачи (2 часа)
**Файлы для создания:**
- `app/tasks/__init__.py` - инициализация задач
- `app/tasks/base.py` - базовые классы задач
- `app/tasks/email_tasks.py` - задачи отправки email

**Базовые задачи:**
- Отправка сообщений WhatsApp
- Анализ настроений
- Выполнение триггеров
- Отправка уведомлений

### Подзадача 10.3: Мониторинг задач (2 часа)
**Файлы для создания:**
- `app/services/task_monitor.py` - мониторинг выполнения
- `app/utils/celery_metrics.py` - метрики Prometheus

**Метрики мониторинга:**
- Количество выполненных задач
- Время выполнения задач
- Количество ошибок
- Размер очереди задач

### Подзадача 10.4: Планировщик задач (2 часа)
**Файлы для создания:**
- `app/core/celery_beat.py` - Celery Beat конфигурация
- `app/utils/periodic_tasks.py` - периодические задачи

**Периодические задачи:**
- Очистка старых сообщений
- Генерация отчетов
- Проверка здоровья системы

### Подзадача 10.5: Детальные тесты Celery (1 час)
**Файлы для создания:**
- `tests/unit/test_celery_tasks.py` - тесты задач
- `tests/integration/test_task_execution.py` - интеграционные тесты

### Подзадача 10.6: Логирование задач (1 час)
**Файлы для создания:**
- `app/core/celery_logging.py` - логирование задач
- `app/utils/task_logger.py` - утилиты логирования

## Критерии готовности
- [ ] Celery настроен и работает
- [ ] Задачи выполняются асинхронно
- [ ] Мониторинг функционирует
- [ ] Планировщик работает
- [ ] Все тесты проходят
- [ ] Покрытие тестами >85%
